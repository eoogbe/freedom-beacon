var FREE=FREE||{};FREE.MainBeacon=function(){var $beaconBtn,$timerLabel,countdowner=null;function toggleBeacon(btnText,readonly){$beaconBtn.text(btnText);$timerLabel.prop("readonly",readonly)}function illuminateBeacon(){toggleBeacon("deactivate beacon",true);if(countdowner===null){countdowner=FREE.Countdowner;countdowner.init()}countdowner.countdown($('input[name="main-timer"]'),illuminateBeacon)}function deactivateBeacon(){toggleBeacon("illuminate beacon",null);countdowner.stop()}function beaconToggled(){$beaconBtn.toggleClass("btn-primary");$beaconBtn.toggleClass("btn-default");$timerLabel.toggleClass("readonly");if($(this).is(":checked")){illuminateBeacon()}else{deactivateBeacon()}}function registerEventHandlers(){$("#beacon").change(beaconToggled)}function init(){$beaconBtn=$(".beacon-btn");$timerLabel=$('input[name="main-timer"]')}return{init:init,registerEventHandlers:registerEventHandlers}}();var FREE=FREE||{};FREE.Facebook=function(){var url;function afterPost(){url.redirect("/beacons/create")}function addSessionData(){FB.api("/me",function(response){var data={fbId:response.id,name:response.name};$.post("/sessions",data,afterPost)})}function loginClicked(){if(FB.getLoginStatus()==="connected"){addSessionData()}else{FB.login(function(response){if(response.authResponse)addSessionData()})}}function logoutClicked(){FB.logout();url.redirect("/")}function init(facebook){$.ajaxSetup({cache:true});$.getScript("//connect.facebook.net/en_US/all.js",function(){FB.init({appId:$('input[name="app-id"]').val(),status:true,cookie:true,xfbml:true});$('button[name="logout"]').click(logoutClicked);$('button[name="login"]').click(loginClicked)});url=FREE.Url;url.init()}return{init:init}}();var FREE=FREE||{};FREE.DistanceFlyout=function(){function closeClicked(){$(this).parent().hide()}function distanceClicked(e){e.preventDefault();$(this).siblings(".distance-flyout").show()}function registerEventHandlers(){$(".distance-link").click(distanceClicked);$('button[name="close-btn"]').click(closeClicked)}return{init:function(){},registerEventHandlers:registerEventHandlers}}();var FREE=FREE||{};FREE.FriendsList=function(){function getFriendData(friend,fbFriend){return{name:friend.name,fbUsername:fbFriend.username,distance:friend.distance,time:friend.time}}function addFriend(friends,friend,fbFriend){if(friend.isFree){var friendData=getFriendData(friend,fbFriend);friends.freeFriends.push(friendData)}else{friends.offlineFriends.push(friend)}}function getFriend(users,fbFriend){for(var i=0;i<users.length;++i){if(users[i].fbId==fbFriend.id)return users[i]}return null}function findFriends(users,fbFriends){var friends={freeFriends:[],offlineFriends:[]};$.each(fbFriends,function(idx,fbFriend){var friend=getFriend(users,fbFriend);if(friend)addFriend(friends,friend,fbFriend)});return friends}function showFriends(friendsHtml){var $friends=$(".friends");$friends.html(friendsHtml);$friends.slideDown();var distanceFlyout=FREE.DistanceFlyout;distanceFlyout.init();distanceFlyout.registerEventHandlers()}function getUsers(fbFriends){$.getJSON("/users",function(data){var friends=findFriends(data.users,fbFriends);$.get("/friends",friends,function(data){showFriends(data)})})}function loadFriends(){var userFbId=$('input[name="userFbId"]').val().slice(1);var path="/"+userFbId+"/friends";FB.api(path,function(fbFriends){getUsers(fbFriends)})}return{init:function(){},loadFriends:loadFriends}}();var FREE=FREE||{};FREE.Countdowner=function(){var DELAY=1e3;var interval;function tick($timer,done){var min=parseInt($timer.data("min"));var sec=parseInt($timer.data("sec"));if(sec<=0&&min<=0){done()}else{if(sec===0){--min;sec=59}else{--sec}$timer.data("min",min);$timer.data("sec",sec);if(sec<10)sec="0"+sec;$timer.val(min+":"+sec)}}function countdown($timer,done){interval=new FREE.Interval(function(){tick($timer,done)},DELAY);interval.start()}function stop(){interval.stop()}return{init:function(){},countdown:countdown,stop:stop}}();var FREE=FREE||{};FREE.Interval=function(fn,delay){var timerId=false;this.start=function(){if(!this.isRunning())timerId=setInterval(fn,delay)};this.stop=function(){clearInterval(timerId);timerId=false};this.isRunning=function(){return timerId!==false}};var FREE=FREE||{};FREE.Url=function(){function redirect(url){window.location=url}function getPathname(){return window.location.pathname}function goBack(){history.back(-1)}return{init:function(){},redirect:redirect,getPathname:getPathname,goBack:goBack}}();"use strict";$(document).ready(function(){initializePage()});function initializePage(){(function(){var facebook=FREE.Facebook.init()})();(function(){var mainBeacon=FREE.MainBeacon;mainBeacon.init();mainBeacon.registerEventHandlers()})();(function(){var friendsList=FREE.FriendsList;friendsList.init();friendsList.registerEventHandlers()})()}
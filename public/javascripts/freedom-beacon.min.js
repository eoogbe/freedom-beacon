var FREE=FREE||{};FREE.HeaderBeacon=function(){function init($parent){$parent.html('<button class="btn btn-primary group-end header-beacon" type="button">illuminate beacon</button>');$(".header-beacon").click(function(){var timerHtml='<input type="number" max="60" min="1" value="30" name="header-timer" class="group-end" autofocus>';$parent.html(timerHtml);var countdowner=FREE.Countdowner;countdowner.init();countdowner.countdown($(timerHtml),init)})}return{init:init}}();var FREE=FREE||{};FREE.MainBeacon=function(){var $beaconBtn,$timerLabel,countdowner=null;function toggleBeacon(btnText,readonly){$beaconBtn.text(btnText);$timerLabel.prop("readonly",readonly)}function illuminateBeacon(){toggleBeacon("deactivate beacon",true);if(countdowner===null){countdowner=FREE.Countdowner;countdowner.init()}countdowner.countdown($('input[name="main-timer"]'),illuminateBeacon)}function deactivateBeacon(){toggleBeacon("illuminate beacon",null);countdowner.stop()}function beaconToggled(){$beaconBtn.toggleClass("btn-primary");$beaconBtn.toggleClass("btn-default");$timerLabel.toggleClass("readonly");if($(this).is(":checked")){illuminateBeacon()}else{deactivateBeacon()}}function registerEventHandlers(){$("#beacon").change(beaconToggled)}function init(){$beaconBtn=$(".beacon-btn");$timerLabel=$('input[name="main-timer"]')}return{init:init,registerEventHandlers:registerEventHandlers}}();var FREE=FREE||{};FREE.MessageForm=function(){function clearInput(){$("input[name='message']").val("")}function appendMessage(message,type){$.get("/partials/conv-item",{message:message,type:type},function(data){$("#messages-box").append(data)})}function messageWritten(e){e.prevenDefault();var usrMsg=$("input[name='message']").val();appendMessage(usrMsg,"user");clearInput();setTimeout(appendMessage,3e3,"Friend's reply","friend")}function registerEventHandlers(){$("#message-form").submit(messageWritten)}return{init:function(){},registerEventHandlers:registerEventHandlers}}();var FREE=FREE||{};FREE.Facebook=function(){var url,FB;function authResponseChanged(response){if(url.getPathname()==="/"){if(response.status==="connected"){url.redirect("/beacons/create")}else{FB.login(function(){url.redirect("/beacons/create")})}}}function loadSdk(){(function(d){var js,id="facebook-jssdk",ref=d.getElementsByTagName("script")[0];if(d.getElementById(id)){return}js=d.createElement("script");js.id=id;js.async=true;js.src="//connect.facebook.net/en_US/all.js";ref.parentNode.insertBefore(js,ref)})(document)}function initFacebook(){loadSdk()}function logoutClicked(){FB.logout();url.redirect("/")}function init(facebook){FB=facebook;FB.init({appId:"1389788214618486",status:true,cookie:true,xfbml:true});url=FREE.Url;url.init()}function registerEventHandlers(){FB.Event.subscribe("auth.authResponseChange",authResponseChanged);$('button[name="logout"]').click(logoutClicked)}return{init:init,initFacebook:initFacebook,registerEventHandlers:registerEventHandlers}}();var FREE=FREE||{};FREE.FriendsList=function(){function meetRequested(e){e.preventDefault();var status=$(this).siblings(".status");status.text("pinged")}function closeClicked(){$(this).parent().hide()}function distanceClicked(){$(this).siblings(".distance-flyout").show()}function registerEventHandlers(){$(".free > a").click(meetRequested);$(".offline > a").click(meetRequested);$('button[name="distance-btn"]').click(distanceClicked);$('button[name="close"]').click(closeClicked)}return{init:function(){},registerEventHandlers:registerEventHandlers}}();var FREE=FREE||{};FREE.Countdowner=function(){var DELAY=6e4;var interval;function tick($timer,done){var min=parseInt($timer.val());if(min>0){$timer.val(min-1)}else if(min===0){done()}}function countdown($timer,done){interval=new FREE.Interval(function(){tick($timer,done)},DELAY);interval.start()}function stop(){interval.stop()}return{init:function(){},countdown:countdown,stop:stop}}();var FREE=FREE||{};FREE.HeaderTimer=function(){var $timer,$container;function hasTimer(){return!isNaN(parseInt($timer.val()))}function makeTimerInvisible(){$timer.css("visibility","hidden")}function replaceWithButton(){FREE.HeaderBeacon.init()}function init(timerElem){$timer=timerElem;$container=$timer.parent()}function run(){if(hasTimer()){var countdowner=FREE.Countdowner;countdowner.init();countdowner.countdown($timer,replaceWithButton)}else{makeTimerInvisible()}}return{init:init,run:run}}();var FREE=FREE||{};FREE.Interval=function(fn,delay){var timerId=false;this.start=function(){if(!this.isRunning())timerId=setInterval(fn,delay)};this.stop=function(){clearInterval(timerId);timerId=false};this.isRunning=function(){return timerId!==false}};var FREE=FREE||{};FREE.BackButton=function(){function backClicked(e){e.preventDefault();var url=FREE.Url;url.init();url.goBack()}function registerEventHandlers(){$(".back-btn").click(backClicked)}return{init:function(){},registerEventHandlers:registerEventHandlers}}();var FREE=FREE||{};FREE.Url=function(){function redirect(url){window.location=url}function getPathname(){return window.location.pathname}function goBack(){history.back(-1)}return{init:function(){},redirect:redirect,getPathname:getPathname,goBack:goBack}}();"use strict";$(document).ready(function(){initializePage()});function initializePage(){function initFacebook(){var facebook=FREE.Facebook;window.fbAsyncInit=function(){facebook.init(FB);facebook.registerEventHandlers()};facebook.initFacebook()}function initBackButton(){var backButton=FREE.BackButton;backButton.init();backButton.registerEventHandlers()}function initHeaderTimer(){var headerTimer=FREE.HeaderTimer;headerTimer.init($('input[name="header-timer"'));headerTimer.run()}function initMainBeacon(){var mainBeacon=FREE.MainBeacon;mainBeacon.init();mainBeacon.registerEventHandlers()}function initFriendsList(){var friendsList=FREE.FriendsList;friendsList.init();friendsList.registerEventHandlers()}function initMessagesForm(){var messageForm=FREE.MessageForm;messageForm.init();messageForm.registerEventHandlers()}initFacebook();initBackButton();initHeaderTimer();initMainBeacon();initFriendsList();initMessagesForm()}